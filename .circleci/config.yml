version: 2.1

orbs:
  windows: circleci/windows@2.2.0

jobs:
    test:
        description: Setup and run application tests
        executor:
            name: windows/default
        steps:
          - checkout
          - run:
              name: "Install project dependencies"
              command: dotnet.exe restore
          - run:
              name: "Run Application Tests"
              command: dotnet.exe test
          - run: 
              name: Generate coverage report
              command: |
                cd ./BucketGame.UnitTest/
                dotnet.exe test /p:CollectCoverage=true /p:CoverletOutput=TestResults/ --collect:"xplat Code Coverage"
          - run:
              name: "Print Working Directory"
              command: pwd
          - store_test_results:
                path: C:\Users\circleci\project\BucketGame.UnitTest\TestResults/coverage.json
          - store_artifacts:
              path: C:\Users\circleci\project\BucketGame.UnitTest\TestResults
    build:
        description: Build application with Release configuration
        executor:
            name: windows/default
        steps:
            - checkout
            - run:
                name: "Build Application according to some given configuration"
                command: dotnet.exe build --configuration Release

workflows:
    test_and_build:
        jobs:
        - test
        - build:
            requires:
                - test
